package com.viplearner.api.services

import com.viplearner.api.client.ApiContext
import com.viplearner.api.client.BaseApiClient
import com.viplearner.api.client.auth.NoAuthProvider
import com.viplearner.api.models.TvChannelsResponse
import io.ktor.client.HttpClient
import io.ktor.client.engine.mock.MockEngine
import io.ktor.client.engine.mock.respond
import io.ktor.client.plugins.contentnegotiation.ContentNegotiation
import io.ktor.http.HttpHeaders
import io.ktor.http.HttpMethod
import io.ktor.http.HttpStatusCode
import io.ktor.http.headersOf
import io.ktor.serialization.kotlinx.json.json
import io.ktor.utils.io.ByteReadChannel
import kotlinx.coroutines.test.runTest
import kotlinx.serialization.json.Json
import kotlin.test.BeforeTest
import kotlin.test.Test
import kotlin.test.assertEquals
import kotlin.test.assertNotNull
import kotlin.test.assertTrue

/**
 * Generated test file for TvService
 *
 * This file was automatically generated by the test generator script.
 * It contains tests for all API endpoints in the TvService service.
 *
 * Tests use MockEngine to simulate HTTP responses and verify requests.
 */
class TvServiceTest {
    @BeforeTest
    fun setup() {
        // Setup will be customized per test with mock engine
    }

    @Test
    fun testTvchannels() =
        runTest {
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "chess960": {
                                        "user": {
                                                    "name": "jean_val_jean",
                                                    "flair": "people.couple-with-heart-man-man-dark-skin-tone-light-skin-tone",
                                                    "id": "jean_val_jean"
                                        },
                                        "rating": 2448,
                                        "gameId": "A86sOhFU",
                                        "color": "white"
                            },
                            "best": {
                                        "user": {
                                                    "name": "Sergoy45",
                                                    "title": "GM",
                                                    "flair": "nature.wolf",
                                                    "id": "sergoy45"
                                        },
                                        "rating": 2955,
                                        "gameId": "tL6k89SU",
                                        "color": "black"
                            },
                            "antichess": {
                                        "user": {
                                                    "name": "Hodobox",
                                                    "flair": "smileys.melting-face",
                                                    "id": "hodobox"
                                        },
                                        "rating": 2220,
                                        "gameId": "ddKTixTl",
                                        "color": "white"
                            },
                            "computer": {
                                        "user": {
                                                    "name": "Mathusalae",
                                                    "id": "mathusalae"
                                        },
                                        "rating": 2207,
                                        "gameId": "G0gAKCwa",
                                        "color": "black"
                            },
                            "bullet": {
                                        "user": {
                                                    "name": "Sergoy45",
                                                    "title": "GM",
                                                    "flair": "nature.wolf",
                                                    "id": "sergoy45"
                                        },
                                        "rating": 2955,
                                        "gameId": "tL6k89SU",
                                        "color": "black"
                            },
                            "horde": {
                                        "user": {
                                                    "name": "ILikeBlitz",
                                                    "title": "GM",
                                                    "flair": "nature.cloud-with-lightning",
                                                    "id": "ilikeblitz"
                                        },
                                        "rating": 2319,
                                        "gameId": "dFkyk9o0",
                                        "color": "white"
                            },
                            "atomic": {
                                        "user": {
                                                    "name": "memeliciouss",
                                                    "flair": "objects.headphone",
                                                    "id": "memeliciouss"
                                        },
                                        "rating": 2042,
                                        "gameId": "IeodZKR1",
                                        "color": "white"
                            },
                            "bot": {
                                        "user": {
                                                    "name": "Cheszter",
                                                    "title": "BOT",
                                                    "id": "cheszter"
                                        },
                                        "rating": 3089,
                                        "gameId": "YmdxmQl5",
                                        "color": "black"
                            },
                            "racingKings": {
                                        "user": {
                                                    "name": "CyberShredder",
                                                    "flair": "symbols.linux-tux-penguin",
                                                    "id": "cybershredder"
                                        },
                                        "rating": 2378,
                                        "gameId": "F95lDLUT",
                                        "color": "white"
                            },
                            "ultraBullet": {
                                        "user": {
                                                    "name": "Traymond",
                                                    "id": "traymond"
                                        },
                                        "rating": 2015,
                                        "gameId": "mcX8eRbF",
                                        "color": "black"
                            },
                            "blitz": {
                                        "user": {
                                                    "name": "Toro123",
                                                    "title": "IM",
                                                    "id": "toro123"
                                        },
                                        "rating": 2655,
                                        "gameId": "ENgdWtYK",
                                        "color": "white"
                            },
                            "kingOfTheHill": {
                                        "user": {
                                                    "name": "StefanBojin",
                                                    "id": "stefanbojin"
                                        },
                                        "rating": 2006,
                                        "gameId": "DMwk2SD4",
                                        "color": "black"
                            },
                            "crazyhouse": {
                                        "user": {
                                                    "name": "Reinemer",
                                                    "id": "reinemer"
                                        },
                                        "rating": 2185,
                                        "gameId": "AWFEu0Bj",
                                        "color": "black"
                            },
                            "threeCheck": {
                                        "user": {
                                                    "name": "Limochess",
                                                    "id": "limochess"
                                        },
                                        "rating": 2229,
                                        "gameId": "wdXLBmip",
                                        "color": "black"
                            },
                            "classical": {
                                        "user": {
                                                    "name": "ReubenFine2025",
                                                    "id": "reubenfine2025"
                                        },
                                        "rating": 2565,
                                        "gameId": "UgBieNXf",
                                        "color": "white"
                            },
                            "rapid": {
                                        "user": {
                                                    "name": "Ondiiik2007",
                                                    "flair": "smileys.cold-face",
                                                    "id": "ondiiik2007"
                                        },
                                        "rating": 2494,
                                        "gameId": "4QIYyyuQ",
                                        "color": "black"
                            }
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: GET api/tv/channels
                    assertEquals("api/tv/channels", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("GET"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = TvService(testApiClient)

            // Act
            val result = testService.tvChannels()

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")
            val response: TvChannelsResponse? = result.getOrNull()
            assertNotNull(response, "Response should not be null")
            // Verify field: chess960
            // Verify field: best
            // Verify field: antichess

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testTvfeedNotImplemented() {
        // TODO: No examples found in OpenAPI spec for this endpoint
        // Endpoint: GET api/tv/feed
        // Service method: TvService.tvFeed()
        // This test is skipped until examples are available in the OpenAPI specification
    }

    @Test
    fun testTvchannelfeedNotImplemented() {
        // TODO: No examples found in OpenAPI spec for this endpoint
        // Endpoint: GET api/tv/${channel}/feed
        // Service method: TvService.tvChannelFeed()
        // This test is skipped until examples are available in the OpenAPI specification
    }

    @Test
    fun testTvchannelgames_example0() =
        runTest {
            val channel = "mock"
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                "[Event \"Rated Blitz game\"]\n[Site \"https://lichess.org/fY44h4OY\"]\n[Date \"2018.03.29\"]\n[Round \"-\"]\n[White \"pveldman\"]\n[Black \"thibault\"]\n[Result \"1-0\"]\n[UTCDate \"2018.03.29\"]\n[UTCTime \"01:38:15\"]\n[WhiteElo \"1610\"]\n[BlackElo \"1601\"]\n[WhiteRatingDiff \"+10\"]\n[BlackRatingDiff \"-10\"]\n[Variant \"Standard\"]\n[TimeControl \"180+0\"]\n[ECO \"C62\"]\n[Opening \"Ruy Lopez: Steinitz Defense\"]\n[Termination \"Normal\"]\n\n1. e4 { [%clk 0:03:00] } e5 { [%clk 0:03:00] } 2. Nf3 { [%clk 0:02:59] } Nc6 { [%clk 0:02:58] } 3. Bb5 { [%clk 0:02:57] } d6 { [%clk 0:02:55] } 4. h3 { [%clk 0:02:54] } Nf6 { [%clk 0:02:52] } 5. Bxc6+ { [%clk 0:02:52] } bxc6 { [%clk 0:02:49] } 6. d3 { [%clk 0:02:51] } Be7 { [%clk 0:02:46] } 7. O-O { [%clk 0:02:47] } O-O { [%clk 0:02:45] } 8. b3 { [%clk 0:02:45] } d5 { [%clk 0:02:45] } 9. exd5 { [%clk 0:02:33] } cxd5 { [%clk 0:02:40] } 10. Nxe5 { [%clk 0:02:31] } Qd6 { [%clk 0:02:38] } 1-0\n"
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: GET api/tv/${channel}
                    assertEquals("api/tv/$channel", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("GET"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/x-chess-pgn"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = TvService(testApiClient)

            // Act
            val result = testService.tvChannelGames(channel = "mock")

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Add specific field assertions here

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testTvchannelgames_example1() =
        runTest {
            val channel = "mock"
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "id": "dxBS4CGQ",
                            "rated": true,
                            "variant": "standard",
                            "speed": "bullet",
                            "perf": "bullet",
                            "createdAt": 1758636886990,
                            "lastMoveAt": 1758636939684,
                            "status": "started",
                            "source": "pool",
                            "players": {
                                        "white": {
                                                    "user": {
                                                                "name": "Ediz_Gurel",
                                                                "title": "GM",
                                                                "flair": "smileys.alien",
                                                                "id": "ediz_gurel"
                                                    },
                                                    "rating": 3306
                                        },
                                        "black": {
                                                    "user": {
                                                                "name": "Polyclinical",
                                                                "id": "polyclinical"
                                                    },
                                                    "rating": 3096
                                        }
                            },
                            "opening": {
                                        "eco": "B10",
                                        "name": "Caro-Kann Defense: Two Knights Attack",
                                        "ply": 5
                            },
                            "moves": "e4 c6 Nc3 d5 Nf3 dxe4 Nxe4 Nd7 Qe2 Ndf6 d4 Bf5 Ng3 Bg4 c3 e6 h3 Bxf3 Qxf3 Bd6 Bd3 Qa5 O-O Ne7 Ne4 Nxe4 Bxe4 O-O Re1 Rad8 Bd2 Ng6 a3 Qb6 b4 Rfe8 Rad1 Bb8 g3 Qc7 h4 Nf8 h5 f5 Bc2 Qf7 h6 g6",
                            "clocks": [
                                        6000,
                                        6000,
                                        6000,
                                        6000,
                                        5942,
                                        5898,
                                        5942,
                                        5880,
                                        5938,
                                        5736,
                                        5908,
                                        5624,
                                        5660,
                                        5501,
                                        5579,
                                        5445,
                                        5468,
                                        5386,
                                        5468,
                                        5357,
                                        5411,
                                        5175,
                                        5335,
                                        5138,
                                        5217,
                                        5051,
                                        5217,
                                        4871,
                                        5113,
                                        4760,
                                        5054,
                                        4433,
                                        4928,
                                        4318,
                                        4801,
                                        4161,
                                        4748,
                                        4091,
                                        4695,
                                        3929,
                                        4597,
                                        3709,
                                        4519,
                                        3385,
                                        4446,
                                        3358,
                                        4268,
                                        3283
                            ],
                            "pgn": "[Event \"rated bullet game\"]\n[Site \"https://lichess.org/dxBS4CGQ\"]\n[Date \"2025.09.23\"]\n[White \"Ediz_Gurel\"]\n[Black \"Polyclinical\"]\n[Result \"*\"]\n[GameId \"dxBS4CGQ\"]\n[UTCDate \"2025.09.23\"]\n[UTCTime \"14:14:46\"]\n[WhiteElo \"3306\"]\n[BlackElo \"3096\"]\n[WhiteTitle \"GM\"]\n[Variant \"Standard\"]\n[TimeControl \"60+0\"]\n[ECO \"B10\"]\n[Opening \"Caro-Kann Defense: Two Knights Attack\"]\n[Termination \"Unterminated\"]\n\n1. e4 { [%clk 0:01:00] } 1... c6 { [%clk 0:01:00] } 2. Nc3 { [%clk 0:01:00] } 2... d5 { [%clk 0:01:00] } 3. Nf3 { [%clk 0:00:59] } 3... dxe4 { [%clk 0:00:59] } 4. Nxe4 { [%clk 0:00:59] } 4... Nd7 { [%clk 0:00:59] } 5. Qe2 { [%clk 0:00:59] } 5... Ndf6 { [%clk 0:00:57] } 6. d4 { [%clk 0:00:59] } 6... Bf5 { [%clk 0:00:56] } 7. Ng3 { [%clk 0:00:57] } 7... Bg4 { [%clk 0:00:55] } 8. c3 { [%clk 0:00:56] } 8... e6 { [%clk 0:00:54] } 9. h3 { [%clk 0:00:55] } 9... Bxf3 { [%clk 0:00:54] } 10. Qxf3 { [%clk 0:00:55] } 10... Bd6 { [%clk 0:00:54] } 11. Bd3 { [%clk 0:00:54] } 11... Qa5 { [%clk 0:00:52] } 12. O-O { [%clk 0:00:53] } 12... Ne7 { [%clk 0:00:51] } 13. Ne4 { [%clk 0:00:52] } 13... Nxe4 { [%clk 0:00:51] } 14. Bxe4 { [%clk 0:00:52] } 14... O-O { [%clk 0:00:49] } 15. Re1 { [%clk 0:00:51] } 15... Rad8 { [%clk 0:00:48] } 16. Bd2 { [%clk 0:00:51] } 16... Ng6 { [%clk 0:00:44] } 17. a3 { [%clk 0:00:49] } 17... Qb6 { [%clk 0:00:43] } 18. b4 { [%clk 0:00:48] } 18... Rfe8 { [%clk 0:00:42] } 19. Rad1 { [%clk 0:00:47] } 19... Bb8 { [%clk 0:00:41] } 20. g3 { [%clk 0:00:47] } 20... Qc7 { [%clk 0:00:39] } 21. h4 { [%clk 0:00:46] } 21... Nf8 { [%clk 0:00:37] } 22. h5 { [%clk 0:00:45] } 22... f5 { [%clk 0:00:34] } 23. Bc2 { [%clk 0:00:44] } 23... Qf7 { [%clk 0:00:34] } 24. h6 { [%clk 0:00:43] } 24... g6 { [%clk 0:00:33] } *\n\n\n",
                            "clock": {
                                        "initial": 60,
                                        "increment": 0,
                                        "totalTime": 60
                            }
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: GET api/tv/${channel}
                    assertEquals("api/tv/$channel", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("GET"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/x-ndjson"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = TvService(testApiClient)

            // Act
            val result = testService.tvChannelGames(channel = "mock")

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: id
            // Verify field: rated
            // Verify field: variant

            // Cleanup
            testApiClient.close()
        }
}
