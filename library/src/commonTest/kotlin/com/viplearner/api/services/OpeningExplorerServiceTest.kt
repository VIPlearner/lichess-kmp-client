package com.viplearner.api.services

import com.viplearner.api.client.BaseApiClient
import io.ktor.client.*
import io.ktor.client.engine.mock.*
import io.ktor.client.plugins.contentnegotiation.*
import io.ktor.http.*
import io.ktor.serialization.kotlinx.json.*
import io.ktor.utils.io.*
import kotlinx.coroutines.test.runTest
import kotlinx.serialization.json.Json
import kotlin.test.*

/**
 * Generated test file for OpeningExplorerService
 *
 * This file was automatically generated by the test generator script.
 * It contains tests for all API endpoints in the OpeningExplorerService service.
 *
 * Tests use MockEngine to simulate HTTP responses and verify requests.
 */
class OpeningExplorerServiceTest {
    @BeforeTest
    fun setup() {
        // Setup will be customized per test with mock engine
    }

    @Test
    fun testOpeningexplorermaster() =
        runTest {
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "white": 1828,
                            "draws": 4904,
                            "black": 1403,
                            "moves": [
                                        {
                                                    "uci": "c6d5",
                                                    "san": "cxd5",
                                                    "averageRating": 2414,
                                                    "white": 1828,
                                                    "draws": 4904,
                                                    "black": 1402,
                                                    "game": null,
                                                    "opening": null
                                        },
                                        {
                                                    "uci": "g8f6",
                                                    "san": "Nf6",
                                                    "averageRating": 2515,
                                                    "white": 0,
                                                    "draws": 0,
                                                    "black": 1,
                                                    "game": {
                                                                "id": "1EErB5jc",
                                                                "winner": "black",
                                                                "black": {
                                                                            "name": "Dobrov, Vladimir",
                                                                            "rating": 2515
                                                                },
                                                                "white": {
                                                                            "name": "Drozdovskij, Yuri",
                                                                            "rating": 2509
                                                                },
                                                                "year": 2006,
                                                                "month": "2006-01"
                                                    },
                                                    "opening": {
                                                                "eco": "D06",
                                                                "name": "Queen's Gambit Declined: Marshall Defense, Tan Gambit"
                                                    }
                                        }
                            ],
                            "topGames": [
                                        {
                                                    "uci": "c6d5",
                                                    "id": "kN6d9l2i",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Anand, V.",
                                                                "rating": 2785
                                                    },
                                                    "white": {
                                                                "name": "Carlsen, M.",
                                                                "rating": 2881
                                                    },
                                                    "year": 2014,
                                                    "month": "2014-06"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "qeYPJL2y",
                                                    "winner": "white",
                                                    "black": {
                                                                "name": "Carlsen, M.",
                                                                "rating": 2843
                                                    },
                                                    "white": {
                                                                "name": "So, W.",
                                                                "rating": 2778
                                                    },
                                                    "year": 2018,
                                                    "month": "2018-06"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "VpWYyv3g",
                                                    "winner": null,
                                                    "black": {
                                                                "name": "Carlsen, M..",
                                                                "rating": 2847
                                                    },
                                                    "white": {
                                                                "name": "So, W..",
                                                                "rating": 2770
                                                    },
                                                    "year": 2021,
                                                    "month": "2021-03"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "nlh6QPSg",
                                                    "winner": "white",
                                                    "black": {
                                                                "name": "Vachier Lagrave, Maxime",
                                                                "rating": 2778
                                                    },
                                                    "white": {
                                                                "name": "Caruana, Fabiano",
                                                                "rating": 2835
                                                    },
                                                    "year": 2020,
                                                    "month": "2020-06"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "IYy7abvG",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Caruana, Fabiano",
                                                                "rating": 2835
                                                    },
                                                    "white": {
                                                                "name": "So, Wesley",
                                                                "rating": 2770
                                                    },
                                                    "year": 2020,
                                                    "month": "2020-06"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "sKEBcLbM",
                                                    "winner": null,
                                                    "black": {
                                                                "name": "Carlsen, M.",
                                                                "rating": 2832
                                                    },
                                                    "white": {
                                                                "name": "Grischuk, A.",
                                                                "rating": 2761
                                                    },
                                                    "year": 2017,
                                                    "month": "2017-06"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "ambcPQzJ",
                                                    "winner": "white",
                                                    "black": {
                                                                "name": "Nakamura, Hikaru",
                                                                "rating": 2775
                                                    },
                                                    "white": {
                                                                "name": "Aronian, Levon",
                                                                "rating": 2813
                                                    },
                                                    "year": 2013,
                                                    "month": "2013-05"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "7x23lu2J",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Karjakin, Sergey",
                                                                "rating": 2771
                                                    },
                                                    "white": {
                                                                "name": "Aronian, L.",
                                                                "rating": 2815
                                                    },
                                                    "year": 2014,
                                                    "month": "2014-06"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "FLar3fv2",
                                                    "winner": "white",
                                                    "black": {
                                                                "name": "Duda, Jan Krzysztof",
                                                                "rating": 2757
                                                    },
                                                    "white": {
                                                                "name": "Caruana, Fabiano",
                                                                "rating": 2828
                                                    },
                                                    "year": 2020,
                                                    "month": "2020-10"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "2O6imBL4",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Aronian, L.",
                                                                "rating": 2764
                                                    },
                                                    "white": {
                                                                "name": "Mamedyarov, S.",
                                                                "rating": 2808
                                                    },
                                                    "year": 2018,
                                                    "month": "2018-06"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "4DG6brd6",
                                                    "winner": null,
                                                    "black": {
                                                                "name": "Caruana, Fabiano",
                                                                "rating": 2835
                                                    },
                                                    "white": {
                                                                "name": "Nakamura, Hikaru",
                                                                "rating": 2736
                                                    },
                                                    "year": 2020,
                                                    "month": "2020-05"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "LNwpnUi7",
                                                    "winner": null,
                                                    "black": {
                                                                "name": "Vachier Lagrave, M.",
                                                                "rating": 2779
                                                    },
                                                    "white": {
                                                                "name": "Nakamura, Hi",
                                                                "rating": 2777
                                                    },
                                                    "year": 2018,
                                                    "month": "2018-10"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "f7QMeZlL",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Carlsen, M.",
                                                                "rating": 2840
                                                    },
                                                    "white": {
                                                                "name": "Vallejo Pons, F.",
                                                                "rating": 2711
                                                    },
                                                    "year": 2016,
                                                    "month": "2016-12"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "vZzIG6Vo",
                                                    "winner": "white",
                                                    "black": {
                                                                "name": "Nakamura, Hikaru",
                                                                "rating": 2774
                                                    },
                                                    "white": {
                                                                "name": "Ivanchuk, Vassily",
                                                                "rating": 2776
                                                    },
                                                    "year": 2011,
                                                    "month": "2011-06"
                                        },
                                        {
                                                    "uci": "c6d5",
                                                    "id": "HWWXcBw1",
                                                    "winner": null,
                                                    "black": {
                                                                "name": "Caruana, Fabiano",
                                                                "rating": 2772
                                                    },
                                                    "white": {
                                                                "name": "Nakamura, Hikaru",
                                                                "rating": 2767
                                                    },
                                                    "year": 2013,
                                                    "month": "2013-04"
                                        }
                            ],
                            "opening": {
                                        "eco": "D10",
                                        "name": "Slav Defense: Exchange Variation"
                            }
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: GET masters
                    assertEquals("masters", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("GET"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    baseUrl = "https://lichess.org",
                    token = "test_token",
                    httpClient = mockHttpClient,
                )
            val testService = OpeningExplorerService(testApiClient)

            // Act
            val result = testService.openingExplorerMaster()

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")
            val response = result.getOrNull()
            assertNotNull(response, "Response should not be null")
            // Verify field: white
            // Verify field: draws
            // Verify field: black

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testOpeningexplorerlichess() =
        runTest {
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "white": 15,
                            "draws": 31,
                            "black": 43,
                            "moves": [
                                        {
                                                    "uci": "c7c5",
                                                    "san": "c5",
                                                    "averageRating": 2322,
                                                    "white": 14,
                                                    "draws": 23,
                                                    "black": 35,
                                                    "game": null,
                                                    "opening": null
                                        },
                                        {
                                                    "uci": "c8f5",
                                                    "san": "Bf5",
                                                    "averageRating": 2334,
                                                    "white": 0,
                                                    "draws": 5,
                                                    "black": 7,
                                                    "game": null,
                                                    "opening": null
                                        },
                                        {
                                                    "uci": "d5d4",
                                                    "san": "d4",
                                                    "averageRating": 2320,
                                                    "white": 1,
                                                    "draws": 1,
                                                    "black": 0,
                                                    "game": null,
                                                    "opening": null
                                        },
                                        {
                                                    "uci": "e7e6",
                                                    "san": "e6",
                                                    "averageRating": 2422,
                                                    "white": 0,
                                                    "draws": 1,
                                                    "black": 1,
                                                    "game": null,
                                                    "opening": null
                                        },
                                        {
                                                    "uci": "b8c6",
                                                    "san": "Nc6",
                                                    "averageRating": 2280,
                                                    "white": 0,
                                                    "draws": 1,
                                                    "black": 0,
                                                    "game": {
                                                                "id": "yzxQX4xf",
                                                                "winner": null,
                                                                "black": {
                                                                            "name": "Rositsan, Boris",
                                                                            "rating": 2280
                                                                },
                                                                "white": {
                                                                            "name": "Zsiltzova Lisenko, Lubov",
                                                                            "rating": 2261
                                                                },
                                                                "year": 2004,
                                                                "month": "2004-09"
                                                    },
                                                    "opening": null
                                        }
                            ],
                            "topGames": [
                                        {
                                                    "uci": "c8f5",
                                                    "id": "fuD3WW9W",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Milanovic, Danilo",
                                                                "rating": 2533
                                                    },
                                                    "white": {
                                                                "name": "Todorcevic, Miodrag",
                                                                "rating": 2450
                                                    },
                                                    "year": 2009,
                                                    "month": "2009-10"
                                        },
                                        {
                                                    "uci": "c7c5",
                                                    "id": "IFho3HgN",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Milanovic, Danilo",
                                                                "rating": 2546
                                                    },
                                                    "white": {
                                                                "name": "Dimitrov, Pavel",
                                                                "rating": 2371
                                                    },
                                                    "year": 2009,
                                                    "month": "2009-12"
                                        },
                                        {
                                                    "uci": "c7c5",
                                                    "id": "6SuIGzeL",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Szabo, Gergely Andras",
                                                                "rating": 2526
                                                    },
                                                    "white": {
                                                                "name": "Dimitrov, Pavel",
                                                                "rating": 2376
                                                    },
                                                    "year": 2009,
                                                    "month": "2009-09"
                                        },
                                        {
                                                    "uci": "e7e6",
                                                    "id": "7w6yoBM8",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Johannessen, Leif Erlend",
                                                                "rating": 2564
                                                    },
                                                    "white": {
                                                                "name": "Molander, Riku",
                                                                "rating": 2323
                                                    },
                                                    "year": 2005,
                                                    "month": "2005-12"
                                        },
                                        {
                                                    "uci": "c7c5",
                                                    "id": "p8FjbImK",
                                                    "winner": "white",
                                                    "black": {
                                                                "name": "Looshnikov, Nikolai",
                                                                "rating": 2437
                                                    },
                                                    "white": {
                                                                "name": "Feoktistov, Alexey A",
                                                                "rating": 2421
                                                    },
                                                    "year": 2006,
                                                    "month": "2006-05"
                                        },
                                        {
                                                    "uci": "c7c5",
                                                    "id": "1eGMx2vU",
                                                    "winner": "white",
                                                    "black": {
                                                                "name": "Krylov, M RUS.",
                                                                "rating": 2476
                                                    },
                                                    "white": {
                                                                "name": "Tsoi, Dmitry",
                                                                "rating": 2361
                                                    },
                                                    "year": 2017,
                                                    "month": "2017-10"
                                        },
                                        {
                                                    "uci": "c7c5",
                                                    "id": "oyNQk1Db",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Krivoshey, Sergei",
                                                                "rating": 2493
                                                    },
                                                    "white": {
                                                                "name": "Vonthron, Horst",
                                                                "rating": 2329
                                                    },
                                                    "year": 2005,
                                                    "month": "2005-05"
                                        },
                                        {
                                                    "uci": "c7c5",
                                                    "id": "2v1A9NSJ",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Fiorito, Fabian",
                                                                "rating": 2425
                                                    },
                                                    "white": {
                                                                "name": "Celis Sanchez, Carlos",
                                                                "rating": 2395
                                                    },
                                                    "year": 1993,
                                                    "month": null
                                        },
                                        {
                                                    "uci": "c7c5",
                                                    "id": "raB2V1bJ",
                                                    "winner": null,
                                                    "black": {
                                                                "name": "Hennings, Artur",
                                                                "rating": 2450
                                                    },
                                                    "white": {
                                                                "name": "Brueggemann, Joachim",
                                                                "rating": 2365
                                                    },
                                                    "year": 1979,
                                                    "month": null
                                        },
                                        {
                                                    "uci": "c7c5",
                                                    "id": "lAEGgxWI",
                                                    "winner": null,
                                                    "black": {
                                                                "name": "Savic, Miod1",
                                                                "rating": 2503
                                                    },
                                                    "white": {
                                                                "name": "Ninov, D.",
                                                                "rating": 2288
                                                    },
                                                    "year": 2019,
                                                    "month": "2019-06"
                                        },
                                        {
                                                    "uci": "c7c5",
                                                    "id": "6Cm3f0tl",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Wong, Meng Kong",
                                                                "rating": 2470
                                                    },
                                                    "white": {
                                                                "name": "Cueto Chajtur, Johny",
                                                                "rating": 2306
                                                    },
                                                    "year": 2004,
                                                    "month": "2004-10"
                                        },
                                        {
                                                    "uci": "c7c5",
                                                    "id": "r0mdfUEE",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Munoz Pantoja, M.",
                                                                "rating": 2471
                                                    },
                                                    "white": {
                                                                "name": "Iglesias, Jor",
                                                                "rating": 2294
                                                    },
                                                    "year": 2016,
                                                    "month": "2016-09"
                                        },
                                        {
                                                    "uci": "c7c5",
                                                    "id": "5vYRhgCh",
                                                    "winner": null,
                                                    "black": {
                                                                "name": "Saric, S.",
                                                                "rating": 2406
                                                    },
                                                    "white": {
                                                                "name": "Drazic, S.",
                                                                "rating": 2354
                                                    },
                                                    "year": 2019,
                                                    "month": "2019-04"
                                        },
                                        {
                                                    "uci": "c8f5",
                                                    "id": "sPWKNZvq",
                                                    "winner": null,
                                                    "black": {
                                                                "name": "Tilicheev, Viacheslav",
                                                                "rating": 2415
                                                    },
                                                    "white": {
                                                                "name": "Dimitrov, Pavel",
                                                                "rating": 2323
                                                    },
                                                    "year": 2013,
                                                    "month": "2013-09"
                                        },
                                        {
                                                    "uci": "c7c5",
                                                    "id": "DrGq3Kf9",
                                                    "winner": "black",
                                                    "black": {
                                                                "name": "Ardelean, George Catalin",
                                                                "rating": 2436
                                                    },
                                                    "white": {
                                                                "name": "Szilagyi, Zsolt",
                                                                "rating": 2297
                                                    },
                                                    "year": 2005,
                                                    "month": "2005-08"
                                        }
                            ],
                            "opening": null
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: GET lichess
                    assertEquals("lichess", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("GET"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    baseUrl = "https://lichess.org",
                    token = "test_token",
                    httpClient = mockHttpClient,
                )
            val testService = OpeningExplorerService(testApiClient)

            // Act
            val result = testService.openingExplorerLichess()

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")
            val response = result.getOrNull()
            assertNotNull(response, "Response should not be null")
            // Verify field: white
            // Verify field: draws
            // Verify field: black

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testOpeningexplorerplayer_example0() =
        runTest {
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "white": 366,
                            "draws": 23,
                            "black": 279,
                            "moves": [
                                        {
                                                    "uci": "c2c4",
                                                    "san": "c4",
                                                    "averageOpponentRating": 1695,
                                                    "performance": 1744,
                                                    "white": 361,
                                                    "draws": 23,
                                                    "black": 272,
                                                    "game": null,
                                                    "opening": {
                                                                "eco": "D06",
                                                                "name": "Queen's Gambit"
                                                    }
                                        },
                                        {
                                                    "uci": "c2c3",
                                                    "san": "c3",
                                                    "averageOpponentRating": 1797,
                                                    "performance": 1797,
                                                    "white": 2,
                                                    "draws": 0,
                                                    "black": 2,
                                                    "game": null,
                                                    "opening": null
                                        },
                                        {
                                                    "uci": "e2e4",
                                                    "san": "e4",
                                                    "averageOpponentRating": 1762,
                                                    "performance": 1640,
                                                    "white": 1,
                                                    "draws": 0,
                                                    "black": 2,
                                                    "game": null,
                                                    "opening": {
                                                                "eco": "D00",
                                                                "name": "Blackmar-Diemer Gambit"
                                                    }
                                        },
                                        {
                                                    "uci": "g1f3",
                                                    "san": "Nf3",
                                                    "averageOpponentRating": 1497,
                                                    "performance": 1374,
                                                    "white": 1,
                                                    "draws": 0,
                                                    "black": 2,
                                                    "game": null,
                                                    "opening": {
                                                                "eco": "D02",
                                                                "name": "Queen's Pawn Game: Zukertort Variation"
                                                    }
                                        },
                                        {
                                                    "uci": "h2h4",
                                                    "san": "h4",
                                                    "averageOpponentRating": 1674,
                                                    "performance": 874,
                                                    "white": 0,
                                                    "draws": 0,
                                                    "black": 1,
                                                    "game": {
                                                                "id": "9vA24xBn",
                                                                "winner": "black",
                                                                "speed": "bullet",
                                                                "mode": "rated",
                                                                "black": {
                                                                            "name": "MentalBlood",
                                                                            "rating": 1674
                                                                },
                                                                "white": {
                                                                            "name": "revoof",
                                                                            "rating": 1657
                                                                },
                                                                "year": 2020,
                                                                "month": "2020-06"
                                                    },
                                                    "opening": null
                                        },
                                        {
                                                    "uci": "h2h3",
                                                    "san": "h3",
                                                    "averageOpponentRating": 1696,
                                                    "performance": 2496,
                                                    "white": 1,
                                                    "draws": 0,
                                                    "black": 0,
                                                    "game": {
                                                                "id": "zyI4GGKv",
                                                                "winner": "white",
                                                                "speed": "bullet",
                                                                "mode": "rated",
                                                                "black": {
                                                                            "name": "gocool99",
                                                                            "rating": 1696
                                                                },
                                                                "white": {
                                                                            "name": "revoof",
                                                                            "rating": 1702
                                                                },
                                                                "year": 2020,
                                                                "month": "2020-07"
                                                    },
                                                    "opening": null
                                        }
                            ],
                            "recentGames": [
                                        {
                                                    "uci": "c2c4",
                                                    "id": "ycZbWQZO",
                                                    "winner": "white",
                                                    "speed": "bullet",
                                                    "mode": "rated",
                                                    "black": {
                                                                "name": "Winavesh",
                                                                "rating": 1700
                                                    },
                                                    "white": {
                                                                "name": "revoof",
                                                                "rating": 1700
                                                    },
                                                    "year": 2024,
                                                    "month": "2024-11"
                                        }
                            ],
                            "opening": {
                                        "eco": "D00",
                                        "name": "Queen's Pawn Game"
                            },
                            "queuePosition": 199
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: GET player
                    assertEquals("player", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("GET"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/x-ndjson"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    baseUrl = "https://lichess.org",
                    token = "test_token",
                    httpClient = mockHttpClient,
                )
            val testService = OpeningExplorerService(testApiClient)

            // Act
            val result = testService.openingExplorerPlayer(player = "mock", color = "mock")

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")
            val response = result.getOrNull()
            assertNotNull(response, "Response should not be null")
            // Verify field: white
            // Verify field: draws
            // Verify field: black

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testOpeningexplorerplayer_example1() =
        runTest {
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "opening": {
                                        "eco": "D00",
                                        "name": "Queen's Pawn Game"
                            },
                            "queuePosition": 25,
                            "white": 366,
                            "draws": 23,
                            "black": 279,
                            "moves": [
                                        {
                                                    "uci": "c2c4",
                                                    "san": "c4",
                                                    "averageOpponentRating": 1695,
                                                    "performance": 1744,
                                                    "white": 361,
                                                    "draws": 23,
                                                    "black": 272,
                                                    "game": null,
                                                    "opening": {
                                                                "eco": "D06",
                                                                "name": "Queen's Gambit"
                                                    }
                                        },
                                        {
                                                    "uci": "c2c3",
                                                    "san": "c3",
                                                    "averageOpponentRating": 1797,
                                                    "performance": 1797,
                                                    "white": 2,
                                                    "draws": 0,
                                                    "black": 2,
                                                    "game": null,
                                                    "opening": null
                                        },
                                        {
                                                    "uci": "e2e4",
                                                    "san": "e4",
                                                    "averageOpponentRating": 1762,
                                                    "performance": 1640,
                                                    "white": 1,
                                                    "draws": 0,
                                                    "black": 2,
                                                    "game": null,
                                                    "opening": {
                                                                "eco": "D00",
                                                                "name": "Blackmar-Diemer Gambit"
                                                    }
                                        },
                                        {
                                                    "uci": "g1f3",
                                                    "san": "Nf3",
                                                    "averageOpponentRating": 1497,
                                                    "performance": 1374,
                                                    "white": 1,
                                                    "draws": 0,
                                                    "black": 2,
                                                    "game": null,
                                                    "opening": {
                                                                "eco": "D02",
                                                                "name": "Queen's Pawn Game: Zukertort Variation"
                                                    }
                                        },
                                        {
                                                    "uci": "h2h4",
                                                    "san": "h4",
                                                    "averageOpponentRating": 1674,
                                                    "performance": 874,
                                                    "white": 0,
                                                    "draws": 0,
                                                    "black": 1,
                                                    "game": {
                                                                "id": "9vA24xBn",
                                                                "winner": "black",
                                                                "speed": "bullet",
                                                                "mode": "rated",
                                                                "black": {
                                                                            "name": "MentalBlood",
                                                                            "rating": 1674
                                                                },
                                                                "white": {
                                                                            "name": "revoof",
                                                                            "rating": 1657
                                                                },
                                                                "year": 2020,
                                                                "month": "2020-06"
                                                    },
                                                    "opening": null
                                        }
                            ],
                            "recentGames": [
                                        {
                                                    "uci": "c2c4",
                                                    "id": "ycZbWQZO",
                                                    "winner": "white",
                                                    "speed": "bullet",
                                                    "mode": "rated",
                                                    "black": {
                                                                "name": "Winavesh",
                                                                "rating": 1700
                                                    },
                                                    "white": {
                                                                "name": "revoof",
                                                                "rating": 1700
                                                    },
                                                    "year": 2024,
                                                    "month": "2024-11"
                                        }
                            ]
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: GET player
                    assertEquals("player", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("GET"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/x-ndjson"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    baseUrl = "https://lichess.org",
                    token = "test_token",
                    httpClient = mockHttpClient,
                )
            val testService = OpeningExplorerService(testApiClient)

            // Act
            val result = testService.openingExplorerPlayer(player = "mock", color = "mock")

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")
            val response = result.getOrNull()
            assertNotNull(response, "Response should not be null")
            // Verify field: opening
            // Verify field: queuePosition
            // Verify field: white

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testOpeningexplorermastergameNotImplemented() {
        // TODO: No examples found in OpenAPI spec for this endpoint
        // Endpoint: GET master/pgn/${gameId}
        // Service method: OpeningExplorerService.openingExplorerMasterGame()
        // This test is skipped until examples are available in the OpenAPI specification
    }
}
