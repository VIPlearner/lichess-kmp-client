package com.viplearner.api.services

import com.viplearner.api.client.ApiContext
import com.viplearner.api.client.BaseApiClient
import com.viplearner.api.client.BaseApiClient.Companion.json
import com.viplearner.api.client.auth.NoAuthProvider
import io.ktor.client.HttpClient
import io.ktor.client.engine.mock.MockEngine
import io.ktor.client.engine.mock.respond
import io.ktor.client.plugins.contentnegotiation.ContentNegotiation
import io.ktor.http.HttpHeaders
import io.ktor.http.HttpMethod
import io.ktor.http.HttpStatusCode
import io.ktor.http.headersOf
import io.ktor.serialization.kotlinx.json.json
import io.ktor.utils.io.ByteReadChannel
import kotlinx.coroutines.test.runTest
import kotlinx.serialization.json.Json
import kotlin.random.Random
import kotlin.test.BeforeTest
import kotlin.test.Test
import kotlin.test.assertEquals
import kotlin.test.assertTrue

/**
 * Generated test file for ChallengesService
 *
 * This file was automatically generated by the test generator script.
 * It contains tests for all API endpoints in the ChallengesService service.
 *
 * Tests use MockEngine to simulate HTTP responses and verify requests.
 */
class ChallengesServiceTest {
    @BeforeTest
    fun setup() {
        // Setup will be customized per test with mock engine
    }

    @Test
    fun testChallengelist() =
        runTest {
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "in": [
                                        {
                                                    "id": "6u5R12on",
                                                    "url": "https://lichess.org/6u5R12on",
                                                    "status": "created",
                                                    "challenger": {
                                                                "name": "Bobby",
                                                                "patron": true,
                                                                "patronColor": 1,
                                                                "id": "bobby",
                                                                "rating": 1734
                                                    },
                                                    "destUser": {
                                                                "name": "Mary",
                                                                "id": "mary",
                                                                "rating": 1104
                                                    },
                                                    "variant": {
                                                                "key": "standard",
                                                                "name": "Standard",
                                                                "short": "Std"
                                                    },
                                                    "rated": false,
                                                    "speed": "correspondence",
                                                    "timeControl": {
                                                                "type": "unlimited"
                                                    },
                                                    "color": "random",
                                                    "finalColor": "black",
                                                    "perf": {
                                                                "icon": "\ue019",
                                                                "name": "Correspondence"
                                                    },
                                                    "direction": "in"
                                        }
                            ],
                            "out": []
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: GET api/challenge
                    assertEquals("api/challenge", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("GET"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = ChallengesService(testApiClient)

            // Act
            val result = testService.challengeList()

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: in
            // Verify field: out

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testChallengecreate_example0() =
        runTest {
            val username = "mock"
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "id": "6u5R12on",
                            "url": "https://lichess.org/6u5R12on",
                            "status": "created",
                            "challenger": {
                                        "name": "Bobby",
                                        "patron": true,
                                        "patronColor": 1,
                                        "id": "bobby",
                                        "rating": 1734
                            },
                            "destUser": {
                                        "name": "Mary",
                                        "id": "mary",
                                        "rating": 1104
                            },
                            "variant": {
                                        "key": "standard",
                                        "name": "Standard",
                                        "short": "Std"
                            },
                            "rated": false,
                            "speed": "correspondence",
                            "timeControl": {
                                        "type": "unlimited"
                            },
                            "color": "random",
                            "finalColor": "black",
                            "perf": {
                                        "icon": "\ue019",
                                        "name": "Correspondence"
                            },
                            "direction": "out"
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: POST api/challenge/${username}
                    assertEquals("api/challenge/$username", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("POST"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = ChallengesService(testApiClient)

            // Act
            val result = testService.challengeCreate(username = "mock", formData = emptyMap())

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: id
            // Verify field: url
            // Verify field: status

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testChallengecreate_example1() =
        runTest {
            val username = "mock"
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "id": "H9fIRZUk",
                            "url": "https://lichess.org/H9fIRZUk",
                            "status": "created",
                            "challenger": {
                                        "id": "bot1",
                                        "name": "Bot1",
                                        "rating": 1500,
                                        "title": "BOT",
                                        "provisional": true,
                                        "online": true,
                                        "lag": 4
                            },
                            "destUser": {
                                        "id": "bobby",
                                        "name": "Bobby",
                                        "rating": 1635,
                                        "title": "GM",
                                        "provisional": true,
                                        "online": true,
                                        "lag": 4
                            },
                            "variant": {
                                        "key": "standard",
                                        "name": "Standard",
                                        "short": "Std"
                            },
                            "rated": true,
                            "speed": "rapid",
                            "timeControl": {
                                        "type": "clock",
                                        "limit": 600,
                                        "increment": 0,
                                        "show": "10+0"
                            },
                            "color": "random",
                            "finalColor": "black",
                            "perf": {
                                        "icon": "\ue017",
                                        "name": "Rapid"
                            },
                            "direction": "out"
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: POST api/challenge/${username}
                    assertEquals("api/challenge/$username", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("POST"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = ChallengesService(testApiClient)

            // Act
            val result = testService.challengeCreate(username = "mock", formData = emptyMap())

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: id
            // Verify field: url
            // Verify field: status

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testChallengeshow_example0() =
        runTest {
            val challengeId = "mock"
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "id": "6u5R12on",
                            "url": "https://lichess.org/6u5R12on",
                            "status": "created",
                            "challenger": {
                                        "name": "Bobby",
                                        "patron": true,
                                        "patronColor": 1,
                                        "id": "bobby",
                                        "rating": 1734
                            },
                            "destUser": {
                                        "name": "Mary",
                                        "id": "mary",
                                        "rating": 1104
                            },
                            "variant": {
                                        "key": "standard",
                                        "name": "Standard",
                                        "short": "Std"
                            },
                            "rated": false,
                            "speed": "correspondence",
                            "timeControl": {
                                        "type": "unlimited"
                            },
                            "color": "random",
                            "finalColor": "black",
                            "perf": {
                                        "icon": "\ue019",
                                        "name": "Correspondence"
                            },
                            "direction": "in"
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: GET api/challenge/${challengeId}/show
                    assertEquals("api/challenge/$challengeId/show", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("GET"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = ChallengesService(testApiClient)

            // Act
            val result = testService.challengeShow(challengeId = "mock")

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: id
            // Verify field: url
            // Verify field: status

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testChallengeshow_example1() =
        runTest {
            val challengeId = "mock"
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "id": "H9fIRZUk",
                            "url": "https://lichess.org/H9fIRZUk",
                            "status": "created",
                            "challenger": {
                                        "id": "bot1",
                                        "name": "Bot1",
                                        "rating": 1500,
                                        "title": "BOT",
                                        "provisional": true,
                                        "online": true,
                                        "lag": 4
                            },
                            "destUser": {
                                        "id": "bobby",
                                        "name": "Bobby",
                                        "rating": 1635,
                                        "title": "GM",
                                        "provisional": true,
                                        "online": true,
                                        "lag": 4
                            },
                            "variant": {
                                        "key": "standard",
                                        "name": "Standard",
                                        "short": "Std"
                            },
                            "rated": true,
                            "speed": "rapid",
                            "timeControl": {
                                        "type": "clock",
                                        "limit": 600,
                                        "increment": 0,
                                        "show": "10+0"
                            },
                            "color": "random",
                            "finalColor": "black",
                            "perf": {
                                        "icon": "\ue017",
                                        "name": "Rapid"
                            },
                            "direction": "out"
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: GET api/challenge/${challengeId}/show
                    assertEquals("api/challenge/$challengeId/show", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("GET"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = ChallengesService(testApiClient)

            // Act
            val result = testService.challengeShow(challengeId = "mock")

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: id
            // Verify field: url
            // Verify field: status

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testChallengeaccept() =
        runTest {
            val challengeId = "mock"
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "ok": true
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: POST api/challenge/${challengeId}/accept
                    assertEquals("api/challenge/$challengeId/accept", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("POST"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = ChallengesService(testApiClient)

            // Act
            val result = testService.challengeAccept(challengeId = "mock")

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: ok

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testChallengedecline() =
        runTest {
            val challengeId = "mock"
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "ok": true
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: POST api/challenge/${challengeId}/decline
                    assertEquals("api/challenge/$challengeId/decline", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("POST"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = ChallengesService(testApiClient)

            // Act
            val result = testService.challengeDecline(challengeId = "mock")

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: ok

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testChallengecancel() =
        runTest {
            val challengeId = "mock"
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "ok": true
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: POST api/challenge/${challengeId}/cancel
                    assertEquals("api/challenge/$challengeId/cancel", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("POST"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = ChallengesService(testApiClient)

            // Act
            val result = testService.challengeCancel(challengeId = "mock")

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: ok

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testChallengeai() =
        runTest {
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "id": "9gkby8Lg",
                            "variant": {
                                        "key": "standard",
                                        "name": "Standard",
                                        "short": "Std"
                            },
                            "speed": "correspondence",
                            "perf": "correspondence",
                            "rated": false,
                            "fen": "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
                            "turns": 0,
                            "source": "ai",
                            "status": {
                                        "id": 20,
                                        "name": "started"
                            },
                            "createdAt": 1758636965510,
                            "player": "white",
                            "fullId": "9gkby8LgKkub"
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: POST api/challenge/ai
                    assertEquals("api/challenge/ai", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("POST"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(201),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = ChallengesService(testApiClient)

            // Act
            val result = testService.challengeAi(level = Random.nextInt())

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: id
            // Verify field: variant
            // Verify field: speed

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testChallengeopen() =
        runTest {
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "id": "nMVpeZL8",
                            "url": "https://lichess.org/nMVpeZL8",
                            "status": "created",
                            "challenger": null,
                            "destUser": null,
                            "variant": {
                                        "key": "standard",
                                        "name": "Standard",
                                        "short": "Std"
                            },
                            "rated": false,
                            "speed": "correspondence",
                            "timeControl": {
                                        "type": "unlimited"
                            },
                            "color": "random",
                            "finalColor": "black",
                            "perf": {
                                        "icon": "\ue019",
                                        "name": "Correspondence"
                            },
                            "open": {},
                            "urlWhite": "https://lichess.org/nMVpeZL8?color=white",
                            "urlBlack": "https://lichess.org/nMVpeZL8?color=black"
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: POST api/challenge/open
                    assertEquals("api/challenge/open", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("POST"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = ChallengesService(testApiClient)

            // Act
            val result = testService.challengeOpen()

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: id
            // Verify field: url
            // Verify field: status

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testChallengestartclocks() =
        runTest {
            val gameId = "mock"
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "ok": true
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: POST api/challenge/${gameId}/start-clocks
                    assertEquals("api/challenge/$gameId/start-clocks", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("POST"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = ChallengesService(testApiClient)

            // Act
            val result = testService.challengeStartClocks(gameId = "mock", token1 = "mock")

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: ok

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testRoundaddtime() =
        runTest {
            val gameId = "mock"
            val seconds = "mock"
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "ok": true
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: POST api/round/${gameId}/add-time/${seconds}
                    assertEquals(HttpMethod.parse("POST"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = ChallengesService(testApiClient)

            // Act
            val result = testService.roundAddTime(gameId = "mock", seconds = Random.nextInt())

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: ok

            // Cleanup
            testApiClient.close()
        }

    @Test
    fun testAdminchallengetokens() =
        runTest {
            // Arrange - Mock HTTP response
            val mockResponse =
                """
                {
                            "bobby": "lip_secret",
                            "boris": "lip_secret",
                            "mary": "lip_secret"
                }
                """.trimIndent()

            val mockEngine =
                MockEngine { request ->
                    // Verify request matches expected endpoint: POST api/token/admin-challenge
                    assertEquals("api/token/admin-challenge", request.url.encodedPath.trimStart('/'))
                    assertEquals(HttpMethod.parse("POST"), request.method)

                    respond(
                        content = ByteReadChannel(mockResponse),
                        status = HttpStatusCode.fromValue(200),
                        headers = headersOf(HttpHeaders.ContentType, "application/json"),
                    )
                }

            // Create mock HttpClient with proper configuration
            val mockHttpClient =
                HttpClient(mockEngine) {
                    install(ContentNegotiation) {
                        json(
                            Json {
                                ignoreUnknownKeys = true
                                coerceInputValues = true
                                explicitNulls = false
                            },
                        )
                    }
                }

            // Create service with mocked client
            val testApiClient =
                BaseApiClient(
                    ctx =
                        ApiContext(
                            baseUrl = "https://lichess.org",
                            httpClient = mockHttpClient,
                            authProvider = NoAuthProvider(),
                        ),
                )
            val testService = ChallengesService(testApiClient)

            // Act
            val result = testService.adminChallengeTokens(users = "mock", description = "mock")

            // Assert
            assertTrue(result.isSuccess, "API call should succeed")

            // Verify field: bobby
            // Verify field: boris
            // Verify field: mary

            // Cleanup
            testApiClient.close()
        }
}
